package cc.unknown.module.impl.exploit;

import java.util.Arrays;
import java.util.stream.Collectors;

import cc.unknown.event.impl.EventLink;
import cc.unknown.event.impl.packet.PacketEvent;
import cc.unknown.mixin.interfaces.packet.IC01PacketChatMessage;
import cc.unknown.module.Module;
import cc.unknown.module.impl.ModuleCategory;
import cc.unknown.module.setting.impl.ModeValue;
import net.minecraft.network.play.client.C01PacketChatMessage;

public class ChatBypass extends Module {

	private ModeValue mode = new ModeValue("Mode", "Universoraft", "Universocraft");

	public ChatBypass() {
		super("ChatBypass", ModuleCategory.Exploit);
		this.registerSetting(mode);
	}

	@EventLink
	public void onPacket(PacketEvent e) {
		if (e.isSend()) {
			if (mode.is("Universocraft")) {
				if (e.getPacket() instanceof C01PacketChatMessage) {
	            	C01PacketChatMessage c01 = (C01PacketChatMessage) e.getPacket();
	            	String message = c01.getMessage();
	            	if (!Arrays.stream(new String[]{"/", "!"}).anyMatch(message::startsWith)) {
	            		String m = Arrays.stream(message.split(" ")).map(word -> "y" + word).collect(Collectors.joining(" "));
	            		((IC01PacketChatMessage) c01).setMessage(m);
	                    e.setPacket(c01);
	                }
	            }
			}
	    }
	}
}
