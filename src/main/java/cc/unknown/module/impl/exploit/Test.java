package cc.unknown.module.impl.exploit;

import java.util.concurrent.LinkedBlockingQueue;

import cc.unknown.event.impl.api.EventLink;
import cc.unknown.event.impl.packet.PacketEvent;
import cc.unknown.event.impl.packet.PacketType;
import cc.unknown.module.Module;
import cc.unknown.module.impl.ModuleCategory;
import cc.unknown.utils.network.PacketUtil;
import net.minecraft.network.Packet;
import net.minecraft.network.play.client.C02PacketUseEntity;
import net.minecraft.network.play.client.C03PacketPlayer;
import net.minecraft.network.play.client.C07PacketPlayerDigging;
import net.minecraft.network.play.client.C08PacketPlayerBlockPlacement;
import net.minecraft.network.play.client.C0APacketAnimation;

public class Test extends Module {

	private LinkedBlockingQueue<Packet<?>> packets = new LinkedBlockingQueue<>();
	private boolean currentlyBlinking = false;
	public Test() {
		super("Test", ModuleCategory.Exploit);
	
	}

	@Override
	public void onDisable() {
		if (mc.thePlayer == null) {
			return;
		}

		blink();
	}

	@EventLink
	public void onPacket(PacketEvent e) {
		if (mc.thePlayer == null || !currentlyBlinking || e.getType() != PacketType.Send) {
			return;
		}

		if (e.getPacket() instanceof C02PacketUseEntity) {
			blink();
			return;
		}

		if (e.getPacket() instanceof C03PacketPlayer && !((C03PacketPlayer) e.getPacket()).isMoving()) {
			return;
		}

		if (e.getPacket() instanceof C03PacketPlayer || e.getPacket() instanceof C08PacketPlayerBlockPlacement
				|| e.getPacket() instanceof C0APacketAnimation || e.getPacket() instanceof C07PacketPlayerDigging
				|| e.getPacket() instanceof C02PacketUseEntity) {
			e.setCancelled(true);
			packets.add(e.getPacket());
		}
	}

	private void blink() {
		try {
			while (!packets.isEmpty()) {
				PacketUtil.send(packets.take());
			}
		} catch (Exception e) {
			e.printStackTrace();
		} finally {
		}
		currentlyBlinking = false;
	}

}
